## Документация API

### 1. Пользовательские функции

**1.1. Регистрация и проверка пользователей** (reg)

| Функция                                  | Маршрут            | Метод | Описание                                   | Параметры                                                                                         |
|------------------------------------------|--------------------|-------|--------------------------------------------|---------------------------------------------------------------------------------------------------|
| `checkUser(chatId)`                      | `/users/check.php` | GET   | Проверяет наличие пользователя по ID чата. | `chatId` - ID чата пользователя.                                                                  | 
| `addUser(userId, cleanedText, username)` | `/users/add.php`   | POST  | Добавляет нового пользователя.             | `userId` - ID пользователя; `cleanedText` - ФИО пользователя; `username` - username пользователя. | 

**1.2. Получение оповещений об оплате** (Payment)

| Функция                   | Маршрут               | Метод | Описание                      | Параметры                                             |
|---------------------------|-----------------------|-------|-------------------------------|-------------------------------------------------------|
| `getAllPayments()`        | `/oplata/get_all.php` | GET   | Возвращает список всех оплат. |                                                       | 
| `updatePayments(sentIds)` | `/oplata/update.php`  | POST  | Обновляет статус оплат.       | `sentIds` - массив ID оплат, которые были отправлены. | 

**1.3. Получение информации о зарплате** (Pay)

| Функция                               | Маршрут                     | Метод | Описание                                              | Параметры                                                        |
|---------------------------------------|-----------------------------|-------|-------------------------------------------------------|------------------------------------------------------------------|
| `getLastPaymentForUser(userId, date)` | `/pay/get_last_payment.php` | GET   | Получает информацию о последнем платеже пользователя. | `userId` - ID пользователя; `date` - дата для получения платежа. | 

**1.4. Получение информации о чате** (Admin)

| Функция                         | Маршрут                              | Метод | Описание                                 | Параметры           |
|---------------------------------|--------------------------------------|-------|------------------------------------------|---------------------|
| `getChatInfo(chatId)`           | `/admin/get_chat_info.php`           | GET   | Возвращает информацию о чате.            | `chatId` - ID чата. |
| `getChatMembersCount(chatId)`   | `/admin/get_chat_members_count.php`  | GET   | Возвращает количество участников в чате. | `chatId` - ID чата. |
| `getChatAdministrators(chatId)` | `/admin/get_chat_administrators.php` | GET   | Возвращает список администраторов чата.  | `chatId` - ID чата. |

### 2. Системные функции

**2.1. Проверка и обновление бота** (Bot Service)

| Функция                                            | Маршрут           | Метод | Описание                              | Параметры                                                                                                                                               |
|----------------------------------------------------|-------------------|-------|---------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| `checkBotData(formattedDateTime, instanceNumber)`  | `/bot/check.php`  | GET   | Проверяет актуальность данных о боте. | `formattedDateTime` - текущая дата и время в формате "YYYY-MM-DD HH:mm:ss"; `instanceNumber` - случайное число, уникальное для каждого экземпляра бота. | 
| `updateBotData(formattedDateTime, instanceNumber)` | `/bot/update.php` | POST  | Обновляет данные о боте.              | `formattedDateTime` - текущая дата и время в формате "YYYY-MM-DD HH:mm:ss"; `instanceNumber` - случайное число, уникальное для каждого экземпляра бота. | 

**2.2. Метрики** (Director Metrics)

| Функция              | Маршрут                   | Метод | Описание                                      | Параметры |
|----------------------|---------------------------|-------|-----------------------------------------------|-----------|
| `fetchMetrics()`     | `/metrics/get.php`        | GET   | Возвращает актуальные метрики.                |           | 
| `getMetricsMaster()` | `/metrics/get_master.php` | GET   | Возвращает актуальные метрики для мастера.    |           |
| `getMetricsNach()`   | `/metrics/get_nach.php`   | GET   | Возвращает актуальные метрики для начальника. |           |

**2.3. Комментарии** (SK Comment)

| Функция                                     | Маршрут                | Метод | Описание                             | Параметры                                                                          |
|---------------------------------------------|------------------------|-------|--------------------------------------|------------------------------------------------------------------------------------|
| `getAllComments()`                          | `/comment/get_all.php` | GET   | Возвращает список всех комментариев. |                                                                                    | 
| `updateComment(taskID, commentText = null)` | `/comment/update.php`  | POST  | Обновляет комментарий к задаче.      | `taskID` - ID задачи; `commentText` - текст комментария (необязательный параметр). | 

**2.4. Логирование** (Log Service)

| Функция                | Маршрут        | Метод | Описание                       | Параметры                                        |
|------------------------|----------------|-------|--------------------------------|--------------------------------------------------|
| `sendLogData(logData)` | `/log/log.php` | POST  | Отправляет данные лога в базу. | `logData` - объект с данными для отправки в лог. | 

**2.5. Фотографии** (Photo не запущено в использование)

| Функция                                                | Маршрут          | Метод | Описание                       | Параметры                                                                                                                      |
|--------------------------------------------------------|------------------|-------|--------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| `addPhotoData(user_id, party, comments_otk, location)` | `/photo/add.php` | POST  | Добавляет данные о фотографии. | `user_id` - ID пользователя; `party` - номер партии; `comments_otk` - комментарий ОТК; `location` - местоположение фотографии. | 

### 3. Переменные окружения

| Переменная   | Описание                               |
|--------------|----------------------------------------|
| `SECRET_KEY` | Секретный ключ для аутентификации API. |
| `BOT_TOKEN`  | Токен бота Telegram.                   |
| `WEB_API`    | Базовый URL API.                       |

### 4. Использование API

* Перед использованием API необходимо получить секретный ключ и токен бота Telegram.
* Все запросы к API должны содержать заголовок `Authorization` с секретным ключом.
* Методы API могут возвращать разные типы данных: JSON, HTML, текст. 

